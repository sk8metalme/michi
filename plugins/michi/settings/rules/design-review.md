# 設計レビュー判定基準

## 目的

技術設計のインタラクティブな品質レビューを実施し、実装前に設計の妥当性を検証するためのガイドライン。

## 適用場面

- `/michi:review-design` コマンドで設計書をレビューする際
- 設計フェーズ完了後、タスク生成前の検証時
- 設計書の品質チェック時

---

## ルール詳細

### 1. レビュープロセス

設計レビューは以下の4段階で実施します：

#### Phase 1: 分析
- 設計ドキュメント（design.md、architecture.md）を読み込む
- 要件定義書（requirements.md）との整合性を確認
- マスタードキュメント（structure.md、tech.md、product.md）との一致を検証

#### Phase 2: クリティカルな問題の特定
- **最大3つの問題**に絞る
- 成功に大きく影響するもののみを対象
- 優先順位を明確にする

#### Phase 3: 強みの認識
- 設計の優れた点を1-2つ挙げる
- バランスの取れた評価を提供
- ポジティブな側面を明示

#### Phase 4: GO/NO-GO決定
- 根拠を含む明確な決定
- 次のステップをガイド

---

### 2. GO/NO-GO決定基準

#### GO（実装開始可能）の条件

以下をすべて満たす場合にGO決定を下します：

- [ ] **要件カバレッジ**: すべての必須要件が設計に反映されている
- [ ] **技術的実現可能性**: 選択された技術スタックで実装可能
- [ ] **アーキテクチャ整合性**: システム全体のアーキテクチャと矛盾がない
- [ ] **セキュリティ考慮**: 基本的なセキュリティ対策が含まれている
- [ ] **パフォーマンス考慮**: 性能要件が設計に反映されている
- [ ] **保守性**: コードの保守性が考慮されている

**許容可能なリスク**:
- 軽微な改善提案は、実装中に対処可能
- 詳細な実装判断は、開発中に決定可能

#### NO-GO（設計修正が必要）の条件

以下のいずれかに該当する場合はNO-GO決定を下します：

- ❌ **クリティカルな要件欠落**: 必須要件が設計に含まれていない
- ❌ **技術的な実現不可能性**: 選択された技術で実装できない
- ❌ **重大なセキュリティリスク**: セキュリティ設計が不十分
- ❌ **パフォーマンス問題**: 性能要件を満たせない設計
- ❌ **アーキテクチャ矛盾**: システム全体と整合性がない

---

### 3. クリティカルな問題の特定

#### 問題の優先順位付け

**最大3つの問題**に絞り、以下の基準で優先順位を付けます：

1. **Priority 1（クリティカル）**: 実装をブロックする問題
   - 例: 必須要件の欠落、技術的実現不可能性

2. **Priority 2（重要）**: 実装品質に大きく影響する問題
   - 例: セキュリティリスク、パフォーマンス懸念

3. **Priority 3（改善提案）**: 実装は可能だが改善が望ましい
   - 例: 保守性の向上、コード品質の改善

#### 問題の記述形式

各問題は以下の形式で記述します：

```markdown
### Issue 1: [問題のタイトル]

**カテゴリ**: [要件カバレッジ/技術的実現可能性/セキュリティ/パフォーマンス/保守性]

**優先度**: [Priority 1/2/3]

**詳細**:
具体的な問題の説明（2-3文）

**影響**:
この問題が実装に与える影響

**推奨アクション**:
具体的な修正案または対応方法
```

---

### 4. バランスの取れた評価

#### 強みの認識

問題だけでなく、設計の優れた点も必ず挙げます。

**認識すべき強み**:
- 要件を効果的にカバーしている点
- 技術選択が適切な理由
- アーキテクチャの優れた設計パターン
- セキュリティやパフォーマンスへの配慮
- 保守性や拡張性の高い設計

**記述形式**:
```markdown
### 設計の強み

1. **[強みのタイトル]**: 簡潔な説明（1-2文）
2. **[強みのタイトル]**: 簡潔な説明（1-2文）
```

---

### 5. インタラクティブなアプローチ

設計レビューは**対話的**に実施します。

#### ユーザーとの関与

- **初期フィードバック**: レビュー開始時に設計の概要を確認
- **問題の確認**: 特定した問題について、ユーザーと議論
- **代替案の提示**: 複数の解決策がある場合は選択肢を提示
- **次のステップの合意**: GO/NO-GO決定後、進め方を合意

#### 避けるべきこと

- ❌ 一方的な評価（対話なし）
- ❌ 完璧主義（許容可能なリスクを過度に排除）
- ❌ 問題の羅列（最大3つに絞る）

---

### 6. アクション可能なフィードバック

すべての提案は**実装可能**でなければなりません。

**良いフィードバックの例**:
- ✅ "認証フローにリフレッシュトークン機構を追加する"
- ✅ "データベースクエリにインデックスを設定してパフォーマンスを改善"
- ✅ "エラーハンドリングを統一するためにカスタム例外クラスを導入"

**悪いフィードバックの例**:
- ❌ "設計を改善する"（具体性がない）
- ❌ "もっと良いアプローチを検討する"（実装方法が不明）
- ❌ "セキュリティを強化する"（具体的な対策がない）

---

## 注意事項

### 完璧主義ではなく品質保証

設計レビューの目的は**完璧な設計**を求めることではなく、**実装可能な品質**を保証することです。

**原則**:
- 許容可能なリスクを受け入れる
- 実装中に改善可能な点は、詳細に追求しない
- クリティカルな問題に集中する

### テスト計画準備状況チェック（Michi拡張）

GO決定後、Phase 4（テスト計画）の完了状況を確認します：

**確認項目**:
- [ ] テストタイプが選択されている（Phase 4.1）
- [ ] テスト仕様書が作成されている（Phase 4.2）

**未完了の場合の推奨アクション**:
1. Phase 4.1-4.2: テスト計画の作成
   - `/michi:plan-tests {feature}` コマンドを実行
   - 設計書の Testing Strategy セクションを基にテストタイプを対話的に選択
   - テスト仕様書を自動生成（テンプレート: `templates/test-specs/unit-test-spec-template.md`）
   - 出力先: `.michi/pj/{feature}/test-specs/`

2. 完了後: `/michi:create-tasks {feature}` でタスク生成に進む

---

## 出力形式

設計レビューの結果は、以下の形式で出力します：

```markdown
# Design Review: {feature}

## レビューサマリー
設計品質と準備状況の簡潔な概要（2-3文）

## クリティカルな問題

### Issue 1: [タイトル]
**カテゴリ**: ...
**優先度**: Priority 1
**詳細**: ...
**影響**: ...
**推奨アクション**: ...

### Issue 2: [タイトル]
...

## 設計の強み

1. **[強みのタイトル]**: 説明
2. **[強みのタイトル]**: 説明

## 最終評価

**決定**: GO / NO-GO

**根拠**:
決定の理由（2-3文）

**次のステップ**:
- GO の場合: テスト計画完了確認 → タスク生成
- NO-GO の場合: 設計修正 → 再レビュー
```

---

## 次のフェーズへの進行

### GO決定の場合

1. **フィードバックのレビュー**: 改善提案を確認
2. **テスト計画の確認**: Phase 4 が完了しているか確認
3. **タスク生成**: `/michi:create-tasks {feature}` で実装タスクを生成

### NO-GO決定の場合

1. **クリティカルな問題への対処**: 特定された問題を修正
2. **設計の再生成**: `/michi:create-design {feature}` を再実行
3. **再検証**: `/michi:review-design {feature}` で再度レビュー

---

**バージョン**: v1.0
**最終更新**: 2026-01-15
