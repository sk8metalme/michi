# EARS形式 要件定義書ルール

## 目的

EARS（Event-Action-Response-System）形式を使用して、テスト可能で検証可能な要件定義を作成するためのガイドライン。

## 適用場面

- `/michi:create-requirements` コマンドで要件定義書を生成する際
- 要件の受入基準を記述する際
- 既存の要件をレビュー・改善する際

---

## ルール詳細

### 1. EARS形式の基本構造

**Event-Action-Response-System（EARS）形式**は、システムの振る舞いを明確に定義するための構文です。

**構文**:
```
WHEN <イベント>, THEN システム SHALL <アクション>
IF <条件>, THEN システム SHALL <応答>
```

**例**:
- WHEN ユーザーがログインボタンをクリックしたとき、THEN システムは認証プロセスを開始する
- IF 入力されたパスワードが誤っている場合、THEN システムはエラーメッセージを表示する

### 2. WHATに焦点を当てる（HOWではなく）

**原則**: 要件定義では「何をするか」を定義し、「どのように実装するか」は設計フェーズで扱う。

**良い例**:
- システムはユーザー認証を提供する SHALL
- システムはセッションタイムアウトを30分に設定する SHALL

**悪い例**:
- システムはJWTトークンを使用してユーザーを認証する（実装詳細）
- システムはRedisにセッションを保存する（技術選択）

### 3. テスト可能な受入基準

すべての要件は**テスト可能**で**検証可能**でなければなりません。

**チェックリスト**:
- [ ] 明確な入力条件が定義されている
- [ ] 期待される出力が具体的に記述されている
- [ ] 成功/失敗の判定基準が明確
- [ ] 数値的に測定可能（パフォーマンス要件の場合）

**例**:
```markdown
## Requirement 1: ユーザー認証

WHEN ユーザーが有効な認証情報を入力したとき、
THEN システムはユーザーをホーム画面にリダイレクトする SHALL

**受入基準**:
- 正しいメールアドレスとパスワードでログイン成功
- 誤った認証情報の場合、エラーメッセージを表示
- 3回連続でログイン失敗した場合、アカウントを30分間ロック
```

### 4. 適切な主語の選択

EARS文では、主語を明確にすることが重要です。

**ガイドライン**:
- システム名/サービス名を使用（例: 認証サービス、決済システム）
- 一貫性を保つ（同じドキュメント内では同じ主語を使用）
- 「ユーザー」と「システム」を明確に区別

**例**:
- ✅ 認証サービスは、ユーザーのパスワードをハッシュ化して保存する SHALL
- ✅ 決済システムは、トランザクション完了後に確認メールを送信する SHALL
- ❌ アプリは処理を行う（曖昧）

### 5. 数値IDの使用ルール

要件の見出しには**先頭に数値IDのみ**を使用します。

**正しい形式**:
- `## Requirement 1: ユーザー認証`
- `## 1. ログイン機能`
- `## 2 データ検証`

**誤った形式**:
- ❌ `## Requirement A: ユーザー認証`（アルファベットID）
- ❌ `## REQ-AUTH-001`（複雑な識別子）

**理由**: 数値IDは順序付けが容易で、トレーサビリティが向上します。

### 6. 要件の論理的グループ化

関連する機能は論理的な要件領域にグループ化します。

**推奨構造**:
```markdown
# Requirements Document

## 1. 認証と認可
### Requirement 1.1: ユーザーログイン
### Requirement 1.2: パスワードリセット
### Requirement 1.3: セッション管理

## 2. データ管理
### Requirement 2.1: データ作成
### Requirement 2.2: データ更新
### Requirement 2.3: データ削除
```

---

## 注意事項

### 初期生成後の反復アプローチ

要件定義は一度で完璧に仕上げる必要はありません。

**推奨プロセス**:
1. **初期バージョンを生成**: プロジェクト説明に基づいて要件を作成
2. **ユーザーレビュー**: 生成された要件をユーザーと確認
3. **フィードバックで反復**: 不足や曖昧さを修正
4. **承認**: 完成度が高まったら承認

**避けるべきこと**:
- ❌ 生成前に連続的な質問を行う（まず初期案を提示）
- ❌ 一度で完璧を目指す（反復的に改善）

### 曖昧さへの対処

要件が曖昧な場合、以下のアプローチを取ります：

1. **初期仮説を提示**: 合理的な仮定に基づいて要件を記述
2. **仮定を明示**: ドキュメント内で仮定を明記
3. **ユーザー確認**: レビュー時に仮定の妥当性を確認

### 完全性チェック

生成後、以下を確認します：

- [ ] すべての期待される機能がカバーされているか
- [ ] 各要件が独立してテスト可能か
- [ ] 要件間の依存関係が明確か
- [ ] 非機能要件（パフォーマンス、セキュリティ）が含まれているか

---

## 参考: マスタードキュメントコンテキストの活用

要件定義生成時は、以下のマスタードキュメントを参照します：

- `docs/master/structure.md`: システム構造とコンポーネント
- `docs/master/tech.md`: 技術スタックと制約
- `docs/master/product.md`: プロダクト方針とビジネスルール

これにより、プロジェクト全体との整合性を保ちます。

---

**バージョン**: v1.0
**最終更新**: 2026-01-15
