# 軽量発見プロセス（Light Discovery）

このドキュメントは、既存システムへの拡張機能の設計時に実施すべき軽量な発見プロセスを定義します。

## 適用対象

以下の場合に、軽量発見プロセスを実行してください:
- **拡張機能**（既存システムへの追加）
- **既存パターンの踏襲が明確**
- **統合ポイントが限定的**

## 発見プロセス

### 1. 統合ポイントの特定

#### 既存コードベースの調査

`Grep`を使用して、以下を特定:
- 統合が必要な既存コンポーネント
- 既存のインターフェース
- 既存の命名規則とパターン

**検索例**:
```bash
# 類似機能の検索
Grep: "class.*Service" --type ts

# 既存のインターフェース検索
Grep: "interface.*Request" --type ts

# 既存のエンドポイント検索
Grep: "router\.(get|post)" --type ts
```

#### 統合ポイントのリスト化

- コンポーネント名
- ファイルパス
- インターフェース定義
- 統合方法（継承、コンポジション、依存注入など）

### 2. 既存パターンの分析

#### パターンの抽出

既存コードから、以下のパターンを抽出:
- **アーキテクチャパターン**:
  - レイヤードアーキテクチャ
  - ヘキサゴナルアーキテクチャ
  - MVC/MVVM

- **デザインパターン**:
  - Repository Pattern
  - Service Pattern
  - Factory Pattern
  - Strategy Pattern

- **命名規則**:
  - クラス名: `{名詞}Service`, `{名詞}Repository`
  - メソッド名: `get{名詞}`, `create{名詞}`
  - ファイル名: `{名詞}.service.ts`, `{名詞}.repository.ts`

#### パターンの踏襲

- 既存パターンに従う箇所
- 拡張が必要な箇所
- 新規パターンが必要な箇所（正当化が必要）

### 3. 互換性の確認

#### 依存関係の確認

- 既存コンポーネントとのバージョン互換性
- 破壊的変更の有無
- 依存関係の循環チェック

#### データ形式の確認

- 既存のデータモデル
- API契約（Request/Response形式）
- データベーススキーマ

### 4. 簡易リスク評価

以下のリスクを簡易評価:
- **統合リスク**: 既存コンポーネントとの統合が複雑か
- **互換性リスク**: バージョンや形式の不整合があるか
- **パフォーマンスリスク**: 既存システムへの影響があるか

### 5. 調査結果の記録

`docs/michi/{feature-name}/research/research.md` に簡潔に記録:

#### サマリー

- 統合ポイント
- 踏襲する既存パターン
- 主要なリスク

#### 統合ポイント詳細

- コンポーネント名とパス
- インターフェース定義
- 統合方法

#### 既存パターン

- パターン名
- 適用箇所
- 参照ファイル

#### リスクと緩和策

- リスク項目
- 緩和策

## 出力形式

`research.md` の構造例（軽量版）:

```markdown
# 調査ログ: {feature-name}（拡張機能）

## サマリー

### 統合ポイント
- [コンポーネント1] at `path/to/component1.ts`
- [コンポーネント2] at `path/to/component2.ts`

### 踏襲する既存パターン
- Repository Pattern（`repositories/` ディレクトリ）
- Service Layer（`services/` ディレクトリ）

### 主要なリスク
- [リスク1]: [緩和策]

## 統合ポイント詳細

### [コンポーネント1]
- **パス**: `path/to/component1.ts`
- **インターフェース**: `interface Foo { ... }`
- **統合方法**: 依存注入

## 既存パターン

### Repository Pattern
- **適用箇所**: データアクセス層
- **参照ファイル**: `repositories/user.repository.ts`
- **踏襲内容**: 同様のメソッド構成

## リスクと緩和策

### [リスク1]
- **影響度**: 中
- **緩和策**: [対策]
```

## 注意事項

- **調査時間**: 30分-1時間程度を目安に
- **既存コードの理解優先**: 新規調査より既存コードの理解を重視
- **パターンの一貫性**: 既存パターンからの逸脱は最小限に
- **完全発見への切り替え**: 複雑さが増した場合は完全発見プロセスに切り替え
