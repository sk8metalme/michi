---
name: /michi:show-status
description: 拡張サマリー付き仕様ステータスと進捗を表示
allowed-tools: Bash, Read, Glob, Write, Edit, MultiEdit, Update
argument-hint: <feature-name>
---

# Michi: 進捗サマリー付き仕様ステータス

<background_information>
- **ミッション**: 仕様の包括的なステータスと進捗を表示する
- **成功基準**:
  - 現在のフェーズと完了ステータスを表示
  - 次のアクションとブロッカーを特定
  - 進捗に関する明確な可視性を提供
  - 品質メトリクスと外部統合ステータスを表示
  - タイムライン情報を表示
</background_information>

## 開発ガイドライン
{{DEV_GUIDELINES}}

---

## 変数定義

- `{{MICHI_DIR}}` = `.michi/` （プロジェクト内）
  - プロジェクトメタデータ: `{{MICHI_DIR}}/pj/`
- `{{MICHI_GLOBAL_DIR}}` = `~/.michi/` （グローバル）
  - 共通設定: `{{MICHI_GLOBAL_DIR}}/settings/`

**パス解釈の注意点:**
- このコマンドで参照するのは主に `{{MICHI_DIR}}/pj/` のプロジェクトメタデータ
- グローバル設定（`{{MICHI_GLOBAL_DIR}}/settings/`）は通常参照しない

---

<instructions>
## コアタスク
機能 **$1** のすべてのフェーズにわたる進捗を示すステータスレポートを生成します。

## 実行手順

### 基本実装

#### ステップ1: 仕様コンテキストの読み込み
- メタデータとフェーズステータスのために `{{MICHI_DIR}}/pj/$1/project.json` を読み取り
- 既存ファイルを読み取り: `docs/michi/$1/spec/requirements.md`, `docs/michi/$1/spec/design.md`, `docs/michi/$1/tasks/tasks.md`（存在する場合）
- `docs/michi/$1/` ディレクトリで利用可能なファイルをチェック

#### ステップ2: ステータスの分析

**各フェーズを解析**:
- **要件**: 要件と受入基準をカウント
- **設計**: アーキテクチャ、コンポーネント、図の確認
- **タスク**: 完了対総タスクをカウント（`- [x]` vs `- [ ]` を解析）
- **承認**: project.json で承認ステータスをチェック

#### ステップ3: レポートの生成

project.json で指定された言語でレポートを作成し、以下をカバー:
1. **現在のフェーズと進捗**: ワークフローのどこにいるか
2. **完了ステータス**: 各フェーズの完了率
3. **タスク内訳**: タスクが存在する場合、完了/残りのカウントを表示
4. **次のアクション**: 次に何をする必要があるか
5. **ブロッカー**: 進捗を妨げている問題

### Michi拡張機能

#### ステップ4: 拡張進捗レポート

レポートに以下の拡張情報を追加:

**品質メトリクス**:
- テストカバレッジ: design.md からのターゲット率（指定されている場合）
- コードレビュー: ステータス（保留中/完了）
- 技術的負債: 存在インジケーター

**タイムライン情報**:
- 各フェーズの完了日（project.json のタイムスタンプから）
- 平均作業時間（類似仕様の統計が利用可能な場合）
- 推定残り時間

## 重要な制約
- project.json の言語を使用
- 正確な完了率を計算
- 具体的な次のアクションコマンドを特定
</instructions>

## ツールガイダンス
- **Read**: 最初に project.json を読み込み、必要に応じて他の仕様ファイルを読み込む
- **注意深く解析**: tasks.md のチェックボックスから完了データを抽出
- **Glob** を使用してどの仕様ファイルが存在するかをチェック

## 出力説明

project.json で指定された言語でステータスレポートを提供:

### 基本出力

**レポート構造**:
1. **機能概要**: 名前、フェーズ、最終更新日
2. **フェーズステータス**: 要件、設計、タスクと完了率
3. **タスク進捗**: タスクが存在する場合、X/Y 完了を表示
4. **次のアクション**: 次に実行する具体的なコマンド
5. **問題**: ブロッカーまたは欠落要素

### Michi拡張出力

基本出力の後に追加:

```text
========================================
 Spec Status: <feature>
========================================

📊 進捗概要
  フェーズ:           実装 (50%)
  要件:               ✅ 承認済み
  設計:               ✅ 承認済み
  タスク:             12/24 完了

🔍 品質メトリクス
  テストカバレッジ:   目標 95% (design.md)
  コードレビュー:     保留中

⏱️  タイムライン
  開始:              2024-01-15
  最終更新:          2024-01-20

📝 次のアクション
  1. /michi:dev <feature>  - 実装を継続
  2. タスク 5.3 の PR #123 をレビュー
```

**形式**: ステータスのために絵文字（✅/⏳/❌）を使用した明確でスキャン可能な形式

### コマンドオプション

出力で提案できる以下のコマンドオプション:

```bash
# すべてのspecのステータス一覧
/michi:show-status --all

# アーカイブ含む全体進捗
/michi:show-status --all --include-archived

# JSON出力（CI/CD統合用）
/michi:show-status <feature> --json
```

## 安全性とフォールバック

### エラーシナリオ

**仕様が見つからない**:
- **メッセージ**: "$1 の仕様が見つかりません。`{{MICHI_DIR}}/pj/` で利用可能な仕様を確認してください"
- **アクション**: 利用可能な仕様ディレクトリをリスト

**不完全な仕様**:
- **警告**: どのファイルが欠落しているかを特定
- **推奨アクション**: 次のフェーズコマンドを指示

### すべての仕様をリスト

すべての利用可能な仕様を確認するには:
- 引数なしで実行またはワイルドカードを使用
- `{{MICHI_DIR}}/pj/` のすべての仕様をそのステータスとともに表示

---


think
