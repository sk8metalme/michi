---
name: /michi:review-design
description: テスト計画準備状況チェック付きインタラクティブな技術設計検証（Michiバージョン）
allowed-tools: Bash, Glob, Grep, LS, Read, Write, Edit, MultiEdit, Update, WebSearch, WebFetch, AskUserQuestion
argument-hint: <feature-name>
---

# Michi: テスト計画付き設計検証

<background_information>
- **ミッション**: 実装の準備が整っていることを確認するために、技術設計のインタラクティブな品質レビューを実施する
- **成功基準**:
  - クリティカルな問題を特定（最大3つの最も重要な懸念事項）
  - 強みを認識したバランスの取れた評価
  - 根拠を含む明確なGO/NO-GO決定
  - 必要に応じて改善のためのアクション可能なフィードバック
  - テスト計画準備状況を確認（Michi拡張）
</background_information>

## 開発ガイドライン

{{DEV_GUIDELINES}}

---

<instructions>
## コアタスク
承認された要件と設計ドキュメントに基づいて、機能 **$1** のインタラクティブな設計品質レビューを実施します。

## 実行手順

### 基本実装

1. **コンテキストの読み込み**:
   - 言語とメタデータのために `{{MICHI_DIR}}/pj/$1/spec.json` を読み取り
   - 要件のために `{{MICHI_DIR}}/pj/$1/requirements.md` を読み取り
   - 設計ドキュメントのために `{{MICHI_DIR}}/pj/$1/design.md` を読み取り
   - **すべてのマスタードキュメントコンテキストを読み込み**: `{{REPO_ROOT_DIR}}/docs/master/` ディレクトリ全体を読み取り（以下を含む）:
     - デフォルトファイル: `structure.md`, `tech.md`, `product.md`
     - すべてのカスタムマスタードキュメントファイル（モード設定に関係なく）
     - これにより完全なプロジェクトメモリとコンテキストを提供

2. **レビューガイドラインの読み取り**:
   - レビュー基準とプロセスのために `{{MICHI_DIR}}/settings/rules/design-review.md` を読み取り

3. **設計レビューの実行**:
   - design-review.md プロセスに従う: 分析 → クリティカルな問題 → 強み → GO/NO-GO
   - 最も重要な懸念事項を3つに制限
   - ユーザーとインタラクティブに関与
   - 出力には spec.json で指定された言語を使用

4. **決定と次のステップの提供**:
   - 根拠を含む明確なGO/NO-GO決定
   - 決定に基づいて進め方をユーザーにガイド

### Michi拡張機能

5. **テスト計画準備状況チェック**:

   設計が承認された場合（GO Decision）、Phase 4（テスト計画）の完了状況を確認:

   **テスト計画完了確認**:
   - `.michi/pj/$1/test-specs/` ディレクトリが存在するか
   - テスト仕様書が作成されているか（Phase 4.2 完了）
   - テストタイプが選択されているか（Phase 4.1 完了）

   **未完了の場合の推奨アクション**:

   Phase 4 が未完了の場合は、タスク生成前に完了することを推奨:

   1. **Phase 4.1: テストタイプの選択**
      - 参照: `docs/user-guide/testing/test-planning-flow.md#phase-03-テストタイプの選択`
      - 設計書の Testing Strategy セクションを基に決定

   2. **Phase 4.2: テスト仕様書の作成**
      - テンプレート:
        - 単体テスト: `docs/user-guide/templates/test-specs/unit-test-spec-template.md`
        - 統合テスト: `docs/user-guide/templates/test-specs/integration-test-spec-template.md`
      - 出力先: `.michi/pj/$1/test-specs/`

   3. **完了後**: `/michi:create-tasks $1` でタスク生成に進む

## 重要な制約
- **完璧主義ではなく品質保証**: 許容可能なリスクを受け入れる
- **クリティカルな焦点のみ**: 最大3つの問題、成功に大きく影響するもののみ
- **インタラクティブなアプローチ**: 一方的な評価ではなく、対話に関与
- **バランスの取れた評価**: 強みと弱みの両方を認識
- **アクション可能なフィードバック**: すべての提案は実装可能でなければならない
</instructions>

## ツールガイダンス
- **最初に読み取り**: レビュー前にすべてのコンテキスト（仕様、マスタードキュメント、ルール）を読み込む
- **必要に応じてGrep**: パターン検証または統合チェックのためにコードベースを検索
- **インタラクティブ**: レビュープロセス全体でユーザーと関与
- **Bash**: テスト計画準備のために test-specs ディレクトリの存在を確認

## 出力説明

spec.json で指定された言語で以下の出力を提供:

### 基本出力

1. **レビューサマリー**: 設計品質と準備状況の簡潔な概要（2-3文）
2. **クリティカルな問題**: 最大3つ、design-review.md 形式に従う
3. **設計の強み**: 1-2つのポジティブな側面
4. **最終評価**: 根拠と次のステップを含むGO/NO-GO決定

### Michi拡張出力

基本出力の後（GO決定の場合）、テスト計画チェックリストを追加:

```text
=== Test Planning Readiness ===

Phase 4 Status:
- [ ] テストタイプ選択完了（Phase 4.1）
- [ ] テスト仕様書作成完了（Phase 4.2）

**テスト計画完了済みの場合**:
→ /michi:create-tasks $1

**テスト計画未完了の場合**:
→ /michi:plan-tests $1  # Phase 4 統合実行
```

**形式要件**:
- 明確にするためにMarkdownの見出しを使用
- design-review.md の出力形式に従う
- 要約を簡潔に保つ

## 安全性とフォールバック

### エラーシナリオ
- **設計欠落**: design.md が存在しない場合、メッセージとともに停止: "最初に `/michi:create-design $1` を実行して設計ドキュメントを生成してください"
- **設計未生成**: spec.json で設計フェーズが生成済みとしてマークされていない場合、警告するがレビューを続行
- **空のマスタードキュメントディレクトリ**: プロジェクトコンテキストが欠落しており、レビュー品質に影響する可能性があることをユーザーに警告
- **言語未定義**: spec.json で言語が指定されていない場合、英語（`en`）をデフォルトとする

### 次のフェーズ: タスク生成

**設計が検証を通過した場合（GO決定）**:
- フィードバックをレビューし、必要に応じて変更を適用
- **推奨**: タスク生成前にPhase 4（テスト計画）を完了
- 実装タスクを生成するために `/michi:create-tasks $1` を実行
- または自動承認して直接進むために `/michi:create-tasks $1 -y` を実行

**設計が改訂を必要とする場合（NO-GO決定）**:
- 特定されたクリティカルな問題に対処
- 改善を加えて `/michi:create-design $1` を再実行
- `/michi:review-design $1` で再検証

**注意**: 設計検証は推奨されますがオプションです。品質レビューは問題の早期発見に役立ちます。

---

**Michi統合**: このコマンドは、タスク生成前の包括的な品質準備を確保するために、テスト計画準備状況チェック（Phase 4）で基本設計検証を拡張します。

think
