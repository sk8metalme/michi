---
name: review-design
description: |
  設計レビュースキル

  技術的妥当性確認、セキュリティチェック、テスト計画準備状況確認を行います。

trigger_keywords:
  - "設計をレビュー"
  - "設計レビュー"
  - "review-design"
---

# review-design: 設計レビュー

設計レビュースキルは、設計書の技術的妥当性、セキュリティ、テスト計画準備状況を確認します。

## 概要

このスキルは以下を実行します：

1. **設計書読み込み**: architecture.md, design.md, sequence.md を読み込み
2. **技術的妥当性確認**:
   - アーキテクチャの整合性
   - データモデルの正規化
   - API設計のRESTful準拠
3. **セキュリティチェック**:
   - OWASP Top 10 準拠確認
   - 認証・認可の実装確認
   - データ暗号化の確認
4. **テスト計画準備状況確認**:
   - テストしやすい設計か
   - モックしやすいインターフェースか
5. **レビュー結果レポート**: 問題点と改善提案を記載

## 使用方法

### 自動発動

以下のキーワードで自動発動します：
- 「設計をレビューしたい」
- 「設計レビュー」
- project.json の `phase: "design-generated"` の場合に自動提案

### 明示的発動

```bash
/michi review-design {pj-name}
```

**例**:
```bash
/michi review-design user-auth
```

## 実行内容

### 1. 設計書読み込み

以下のファイルを読み込みます：
- `docs/michi/YYYYMMDD-{pj-name}/spec/architecture.md`
- `docs/michi/YYYYMMDD-{pj-name}/spec/design.md`
- `docs/michi/YYYYMMDD-{pj-name}/spec/sequence.md`

### 2. 技術的妥当性確認

**アーキテクチャの整合性**:
- レイヤー分離が適切か
- 依存関係が一方向か
- 責任分担が明確か

**データモデルの正規化**:
- 第3正規形まで正規化されているか
- 適切なインデックスが設計されているか

**API設計のRESTful準拠**:
- HTTPメソッドが適切に使用されているか
- ステータスコードが適切か
- リソース設計が適切か

### 3. セキュリティチェック

**OWASP Top 10 準拠確認**:
- SQL Injection対策
- XSS対策
- CSRF対策
- 認証・認可の実装

**データ暗号化**:
- パスワードのハッシュ化
- 通信の暗号化（HTTPS）
- 機密データの暗号化

### 4. テスト計画準備状況確認

**テストしやすい設計**:
- 依存性注入（DI）が使用されているか
- インターフェース分離がされているか

**モックしやすいインターフェース**:
- 外部依存がインターフェース化されているか
- テストダブルが使いやすいか

### 5. レビュー結果レポート

レビュー結果を以下の形式でレポートします：

```markdown
# 設計レビュー結果: {pj-name}

## サマリー
- **合格/不合格**: 合格
- **重大な問題**: 0件
- **軽微な問題**: 2件
- **改善提案**: 3件

## 重大な問題
（なし）

## 軽微な問題

### LI-001: データベースインデックス不足
- **説明**: email カラムにインデックスがない
- **影響**: ログイン時のクエリ性能低下
- **推奨対応**: email カラムに UNIQUE INDEX を追加

### LI-002: エラーハンドリング不足
- **説明**: 外部API呼び出しのエラーハンドリングが不足
- **影響**: 外部API障害時にシステムが停止する可能性
- **推奨対応**: リトライロジックを追加

## 改善提案

### REC-001: キャッシュ層の追加
- **説明**: 頻繁にアクセスされるデータをキャッシュする
- **効果**: レスポンスタイム短縮

### REC-002: 非同期処理の導入
- **説明**: メール送信を非同期化する
- **効果**: ユーザーレスポンス改善

### REC-003: モニタリング設計
- **説明**: メトリクス・ログ・トレースを設計に含める
- **効果**: 運用時の問題検知が容易になる
```

## 次のステップ

設計レビューが完了したら、次のステップに進みます：

### 問題がある場合: 設計を修正

設計書を修正して、再度レビューを実行します。

```bash
/michi create-design {pj-name}
/michi review-design {pj-name}
```

### 問題がない場合: テスト計画またはタスク分割

```bash
/michi plan-tests {pj-name}
```

または

```bash
/michi create-tasks {pj-name}
```

## 参照

- **セキュリティガイドライン**: `~/.claude/security/CLAUDE-security-policy.md`
- **ワークフロー全体**: `../references/workflow-guide.md`
- **コマンドリファレンス**: `../references/command-reference.md`

---

**関連スキル**:
- `create-design` - 設計書作成（修正時）
- `plan-tests` - テスト計画作成（合格後）
- `create-tasks` - タスク分割（合格後）
